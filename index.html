<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>MinPris</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
    }

    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      font-size: 16px;
    }

    button {
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.85;
    }

    h2 {
      margin-top: 30px;
    }

    #resultat {
      margin-top: 20px;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
    }
  </style>
</head>
<body>

<h1>MinPris – tilbudskalkulator</h1>

<textarea id="tekst" placeholder="Beskrivelse av jobben"></textarea>

<input id="timer" placeholder="Timer">
<input id="dager" placeholder="Dager">
<input id="arbeid" placeholder="Arbeid (kr)">
<input id="kjøring" placeholder="Kjøring (kr)">
<input id="forbruk" placeholder="Forbruk (kr)">
<input id="avfall" placeholder="Avfall (kr)">
<input id="total" placeholder="Totalpris (kr)">

<button onclick="generer()">Generer tilbudstekst</button>
<button onclick="lastNedPDF()">Last ned PDF</button>

<h2>Resultat</h2>
<pre id="resultat"></pre>

<script>
async function generer() {
  try {
    const res = await fetch("/api/ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        tekst: tekst.value,
        timer: timer.value,
        dager: dager.value,
        arbeid: arbeid.value,
        kjøring: kjøring.value,
        forbruk: forbruk.value,
        avfall: avfall.value,
        total: total.value
      })
    });

    const data = await res.json();
    document.getElementById("resultat").innerText = data.text;
  } catch (err) {
    alert("Feil ved generering av tekst");
  }
}

async function lastNedPDF() {
  try {
    const res = await fetch("/api/pdf", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        tekst: tekst.value,
        timer: timer.value,
        dager: dager.value,
        arbeid: arbeid.value,
        kjøring: kjøring.value,
        forbruk: forbruk.value,
        avfall: avfall.value,
        total: total.value
      })
    });

    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    window.open(url);
  } catch (err) {
    alert("Feil ved PDF");
  }
}
</script>

</body>
</html>
