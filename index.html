<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>MinPris – tilbudskalkulator</title>
  <style>
    body { font-family: Arial; background:#f2f2f2; padding:20px; }
    .box { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; }
    input, textarea, button {
      width:100%;
      padding:10px;
      margin-top:10px;
      font-size:16px;
    }
    button { background:#111; color:white; cursor:pointer; }
    .result { margin-top:20px; background:#eee; padding:10px; }
  </style>
</head>
<body>

<div class="box">
  <h2>MinPris – tilbudskalkulator</h2>

  <textarea id="desc" placeholder="Beskriv jobben..."></textarea>
  <input id="timepris" placeholder="Timepris (kr)">
  <input id="km" placeholder="Km per dag">
  <input id="avfall" placeholder="Avfall (kr)">
  <input id="forbruk" placeholder="Forbruk per dag (kr)">

  <button onclick="beregn()">Beregn</button>
  <button onclick="generer()">Generer tilbudstekst</button>

  <div class="result" id="resultat"></div>
  <div class="result" id="ai"></div>
</div>

<script>
let total = 0;

function beregn() {
  const timepris = Number(document.getElementById("timepris").value || 0);
  const km = Number(document.getElementById("km").value || 0);
  const avfall = Number(document.getElementById("avfall").value || 0);
  const forbruk = Number(document.getElementById("forbruk").value || 0);

  const timer = 15;
  const dager = 2;

  const arbeid = timer * timepris;
  const kjøring = km * 5;
  total = arbeid + kjøring + avfall + forbruk;

  document.getElementById("resultat").innerHTML = `
    Dager: ${dager}<br>
    Timer: ${timer}<br>
    Arbeid: ${arbeid} kr<br>
    Kjøring: ${kjøring} kr<br>
    Avfall: ${avfall} kr<br>
    Forbruk: ${forbruk} kr<br><br>
    <b>Total: ${total} kr</b>
  `;
}

async function generer() {
  const desc = document.getElementById("desc").value;

  const res = await fetch("/api/ai", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      description: desc,
      price: total
    })
  });

  const data = await res.json();

  document.getElementById("ai").innerHTML = `
    <b>Tilbudstekst:</b><br><br>
    <pre>${data.text}</pre>
    <button onclick="navigator.clipboard.writeText(\`${data.text}\`)">
      Kopier tekst
    </button>
  `;
}
</script>

</body>
</html>
