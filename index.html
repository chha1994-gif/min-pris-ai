<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>MinPris – tilbudskalkulator</title>
  <style>
    body { font-family: Arial; background:#f5f5f5; padding:30px }
    .box { max-width:600px; margin:auto; background:white; padding:20px; border-radius:8px }
    input, textarea, button { width:100%; padding:10px; margin-top:10px }
    button { background:black; color:white; border:none; cursor:pointer }
    pre { background:#eee; padding:10px; white-space:pre-wrap }
  </style>
</head>
<body>

<div class="box">
  <h2>MinPris – tilbudskalkulator</h2>

  <textarea id="desc" placeholder="Beskriv jobben..."></textarea>
  <input id="timepris" placeholder="Timepris (kr)">
  <input id="km" placeholder="Km per dag">
  <input id="avfall" placeholder="Avfall (kr)">
  <input id="forbruk" placeholder="Forbruk per dag (kr)">

  <button onclick="beregn()">Beregn</button>
  <button onclick="generer()">Generer tilbudstekst</button>

  <h3>Resultat</h3>
  <pre id="resultat"></pre>

  <h3>Tilbudstekst</h3>
  <pre id="tekst"></pre>
  <button onclick="kopier()">Kopier tekst</button>
</div>

<script>
let kalkyle = {};

function beregn() {
  const timer = 15;
  const dager = 2;

  const timepris = Number(document.getElementById("timepris").value);
  const km = Number(document.getElementById("km").value);
  const avfall = Number(document.getElementById("avfall").value);
  const forbruk = Number(document.getElementById("forbruk").value);

  const arbeid = timer * timepris;
  const kjøring = km * 5;

  const total = arbeid + kjøring + avfall + forbruk;

  kalkyle = { timer, dager, arbeid, kjøring, avfall, forbruk, total };

  document.getElementById("resultat").textContent =
`Dager: ${dager}
Timer: ${timer}
Arbeid: ${arbeid} kr
Kjøring: ${kjøring} kr
Avfall: ${avfall} kr
Forbruk: ${forbruk} kr

TOTAL: ${total} kr`;
}

async function generer() {
  const res = await fetch("/api/ai", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      beskrivelse: document.getElementById("desc").value,
      ...kalkyle
    })
  });

  const data = await res.json();
  document.getElementById("tekst").textContent = data.text;
}

function kopier() {
  navigator.clipboard.writeText(
    document.getElementById("tekst").textContent
  );
  alert("Tekst kopiert!");
}
</script>

</body>
</html>
